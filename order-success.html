<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Submitted • Pending Confirmation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --card:rgba(255,255,255,.08); --border:rgba(255,255,255,.14);
      --text:#eaf0ff; --muted:rgba(234,240,255,.72);
      --gold:#f5c451; --blue:#0ea5e9; --danger:#ffb4b4; --ok:#bfffd6;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Poppins,system-ui,Segoe UI,Roboto,Arial; color:var(--text);
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(14,165,233,.18), transparent 60%),
        radial-gradient(800px 500px at 80% 30%, rgba(245,196,81,.12), transparent 55%),
        linear-gradient(180deg, #040617 0%, #070a1f 100%);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:22px;
    }
    .wrap{width:100%; max-width:720px;}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:0 20px 70px rgba(0,0,0,.45);
      padding:22px;
      backdrop-filter: blur(10px);
    }
    .brand{display:flex; gap:12px; align-items:center; margin-bottom:14px;}
    .logo{
      width:44px; height:44px; border-radius:12px;
      background:linear-gradient(135deg, rgba(245,196,81,.95), rgba(14,165,233,.85));
      box-shadow:0 18px 45px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    h1{margin:0 0 6px; font-size:20px;}
    p{margin:0 0 14px; color:var(--muted); font-size:13px; line-height:1.55;}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);
      font-size:12px; color:rgba(234,240,255,.85);
    }
    .box{
      padding:12px 14px; border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.20);
      margin-top:12px;
    }
    .label{font-size:12px;color:rgba(234,240,255,.70)}
    .value{font-weight:900;margin-top:2px}
    button,a.btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.08);
      color:var(--text);
      cursor:pointer;
      font-weight:900;
      text-decoration:none;
    }
    .primary{background:var(--blue); color:#00131f; border-color:rgba(14,165,233,.35)}
    .gold{background:linear-gradient(135deg, rgba(245,196,81,.92), rgba(14,165,233,.75)); color:#00131f; border-color:rgba(245,196,81,.30)}
    .msg{margin-top:10px; font-size:13px; color:var(--muted);}
    .msg.err{color:var(--danger)}
    .msg.ok{color:var(--ok)}
    code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div style="font-weight:900">Order Submitted</div>
          <div style="font-size:12px;color:rgba(234,240,255,.65)">Pending admin confirmation</div>
        </div>
      </div>

      <h1 id="headline">Submitting your order…</h1>
      <p>
        Your order will appear as <b>Pending</b> until an admin confirms it.
        After confirmation, your portal account becomes <b>Active</b> and Send/Receive unlocks.
      </p>

      <div class="row">
        <span class="pill" id="pillEmail">Email: —</span>
        <span class="pill" id="pillTier">Tier: —</span>
        <span class="pill" id="pillQty">Qty: —</span>
        <span class="pill" id="pillStatus">Status: —</span>
      </div>

      <div class="box">
        <div class="label">Order ID</div>
        <div class="value" id="orderId">—</div>
        <div class="msg" id="msg"></div>
      </div>

      <div class="row" style="margin-top:14px">
        <a class="btn primary" href="./portal.html">Go to Portal</a>
        <a class="btn" href="./login.html">Back to Login</a>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // =========================
    // PUT YOUR VALUES HERE
    // =========================
    const SUPABASE_URL = "https://qagktukzxtwbjrdgiben.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhZ2t0dWt6eHR3YmpyZGdpYmVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NDA0NTQsImV4cCI6MjA4MzQxNjQ1NH0.cbhSWHGlmhmIt-NmUVBUtAhPpNPDKk4Bz-Gy1TbPzHk";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const headline = document.getElementById("headline");
    const msgEl = document.getElementById("msg");
    const orderIdEl = document.getElementById("orderId");

    const pillEmail = document.getElementById("pillEmail");
    const pillTier = document.getElementById("pillTier");
    const pillQty = document.getElementById("pillQty");
    const pillStatus = document.getElementById("pillStatus");

    function setMsg(text, type){
      msgEl.textContent = text || "";
      msgEl.className = "msg " + (type || "");
    }

    function parseParams(){
      const p = new URLSearchParams(window.location.search);
      const tierRaw = (p.get("tier") || "").toLowerCase().trim();
      const qtyRaw = p.get("qty");
      let tier = (tierRaw === "black" || tierRaw === "silver") ? tierRaw : "silver";
      let qty = 1;

      if(tier === "black"){
        qty = 1;
      } else {
        const n = Number(qtyRaw);
        qty = Number.isFinite(n) ? Math.round(n) : 1;
        if(qty < 1) qty = 1;
        if(qty > 50) qty = 50;
      }

      return { tier, qty };
    }

    async function requireSession(){
      const { data } = await supabase.auth.getSession();
      if(!data?.session){
        window.location.href = "./login.html";
        return null;
      }
      return data.session;
    }

    (async () => {
      const session = await requireSession();
      if(!session) return;

      const email = session.user.email || "";
      pillEmail.textContent = "Email: " + (email || "—");

      const { tier, qty } = parseParams();
      pillTier.textContent = "Tier: " + tier.toUpperCase();
      pillQty.textContent = "Qty: " + String(qty);

      // Insert order
      pillStatus.textContent = "Status: SUBMITTING…";
      headline.textContent = "Submitting your order…";
      setMsg("Creating a pending order record…", "");

      const { data, error } = await supabase
        .from("card_orders")
        .insert([{
          user_id: session.user.id,
          purchaser_email: email,
          tier,
          qty,
          status: "pending"
        }])
        .select("id,status,tier,qty,created_at")
        .single();

      if(error){
        pillStatus.textContent = "Status: ERROR";
        headline.textContent = "Could not submit order";
        setMsg(error.message, "err");
        return;
      }

      orderIdEl.textContent = data.id;
      pillStatus.textContent = "Status: " + String(data.status).toUpperCase();
      headline.textContent = "Order Submitted (Pending)";
      setMsg("Your order is now pending. An admin will confirm it soon.", "ok");
    })();
  </script>
</body>
</html>

