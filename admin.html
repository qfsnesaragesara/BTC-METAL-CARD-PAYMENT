<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Console — QFS</title>
<meta name="robots" content="noindex, nofollow">
<link rel="icon" type="image/png" href="https://github.com/qfsnesaragesara/BTC-METAL-CARD-PAYMENT/blob/main/photo%201.jpg?raw=true" />

<script src="./config.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  :root{
    --bg:#020617;
    --text:#e5e7eb;
    --muted:#94a3b8;
    --border:rgba(148,163,184,0.35);
    --shadow:rgba(2,6,23,0.9);
    --card1:rgba(15,23,42,0.94);
    --card2:rgba(15,23,42,0.82);
    --accent:#38bdf8;
    --accent2:#a855f7;
    --ok:#22c55e;
    --bad:#ef4444;
    --warn:#f59e0b;
    --radius:22px;
    --maxw:1180px;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    padding:22px;
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    background:
      radial-gradient(circle at top, rgba(56,189,248,0.22), transparent 55%),
      radial-gradient(circle at bottom, rgba(147,51,234,0.26), transparent 60%),
      var(--bg);
  }

  .wrap{max-width:var(--maxw); margin:0 auto;}
  .topbar{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:14px 16px; border-radius:999px;
    background:linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.78));
    border:1px solid var(--border);
    box-shadow: 0 28px 110px var(--shadow);
  }
  .brand{display:flex; align-items:center; gap:10px;}
  .logo{
    width:40px; height:40px; border-radius:12px; object-fit:cover;
    box-shadow: 0 14px 44px rgba(2,6,23,0.95), 0 0 0 1px rgba(148,163,184,0.25);
  }
  .brand h1{margin:0; font-size:14px; font-weight:950; letter-spacing:-0.02em;}
  .brand .sub{font-size:12px; color:var(--muted); margin-top:2px;}
  .actions{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center;}
  .pill{
    padding:6px 10px; border-radius:999px; font-size:11px; font-weight:900;
    border:1px solid rgba(148,163,184,0.30);
    background:rgba(255,255,255,0.05);
    color:#cbd5e1;
  }
  .pill.ok{border-color: rgba(34,197,94,0.35); color:#bbf7d0;}
  .pill.warn{border-color: rgba(245,158,11,0.35); color:#fde68a;}
  .btn{
    padding:8px 12px; border-radius:999px;
    border:1px solid rgba(148,163,184,0.35);
    background:rgba(255,255,255,0.06);
    color:var(--text);
    font-weight:900;
    font-size:12px;
    cursor:pointer;
  }

  .banner{
    margin:14px 0 0;
    padding:10px 12px;
    border-radius:14px;
    border:1px solid rgba(148,163,184,0.32);
    background:rgba(2,6,23,0.40);
    color:#cbd5e1;
    white-space:pre-wrap;
  }
  .banner.err{ border-color: rgba(239,68,68,0.35); color:#fecaca; }
  .banner.ok{ border-color: rgba(34,197,94,0.35); color:#bbf7d0; }
  .banner.hide{ display:none; }

  .grid{
    margin-top:16px;
    display:grid;
    grid-template-columns: 1.2fr 1fr;
    gap:16px;
    align-items:start;
  }
  @media (max-width:980px){
    .grid{ grid-template-columns:1fr; }
  }

  .card{
    background:linear-gradient(145deg, var(--card1), var(--card2));
    border:1px solid var(--border);
    border-radius:var(--radius);
    padding:16px;
    box-shadow: 0 28px 110px var(--shadow);
    backdrop-filter: blur(22px);
    position:relative;
    overflow:hidden;
  }
  .card:before{
    content:"";
    position:absolute; inset:-120px -120px auto auto;
    width:320px; height:320px;
    background: radial-gradient(circle at center, rgba(56,189,248,0.12), transparent 60%);
    pointer-events:none;
  }
  .card h2{margin:0 0 6px; font-size:14px; font-weight:950;}
  .card .sub{font-size:12px; color:var(--muted);}

  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px;}
  .input, .select, .textarea{
    width:100%;
    padding:10px 12px;
    border-radius:14px;
    border:1px solid rgba(148,163,184,0.25);
    background:rgba(2,6,23,0.35);
    color:var(--text);
    outline:none;
  }
  .input::placeholder,.textarea::placeholder{ color:rgba(148,163,184,0.65); }
  .select{ cursor:pointer; }

  .split{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
  @media (max-width:560px){ .split{ grid-template-columns:1fr; } }

  table{width:100%; border-collapse:collapse; margin-top:10px; font-size:12px;}
  th, td{padding:10px 8px; border-bottom:1px solid rgba(148,163,184,0.18); text-align:left; vertical-align:top;}
  th{ color:var(--muted); font-size:11px; text-transform:uppercase; letter-spacing:0.06em; }

  .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  .small{ font-size:12px; color:var(--muted); }

  .memberRow{
    cursor:pointer;
    border-radius:12px;
    transition: background .12s ease;
  }
  .memberRow:hover{ background: rgba(255,255,255,0.04); }
  .memberRow.active{ background: rgba(56,189,248,0.08); outline:1px solid rgba(56,189,248,0.25); }

  .toggle{
    display:inline-flex; align-items:center; gap:10px;
    user-select:none;
  }
  .switch{
    width:44px; height:24px; border-radius:999px;
    background:rgba(148,163,184,0.25);
    border:1px solid rgba(148,163,184,0.25);
    position:relative;
    cursor:pointer;
  }
  .knob{
    position:absolute; top:2px; left:2px;
    width:20px; height:20px; border-radius:999px;
    background:#cbd5e1;
    transition: transform .15s ease, background .15s ease;
  }
  .switch.on{ background: rgba(34,197,94,0.18); border-color: rgba(34,197,94,0.30); }
  .switch.on .knob{ transform: translateX(20px); background: #bbf7d0; }

  .badge{
    display:inline-flex; align-items:center; justify-content:center;
    padding:4px 8px; border-radius:999px;
    border:1px solid rgba(148,163,184,0.28);
    background: rgba(255,255,255,0.04);
    font-weight:950; font-size:11px; letter-spacing:0.06em; text-transform:uppercase;
  }
  .badge.ok{ border-color: rgba(34,197,94,0.35); color:#bbf7d0; }
  .badge.no{ border-color: rgba(239,68,68,0.35); color:#fecaca; }

  .amt.credit{ color: var(--ok); font-weight:950; }
  .amt.debit{ color: var(--bad); font-weight:950; }
</style>
</head>

<body>
<div class="wrap">

  <div class="topbar">
    <div class="brand">
      <img class="logo"
        src="https://github.com/qfsnesaragesara/BTC-METAL-CARD-PAYMENT/blob/main/photo%201.jpg?raw=true"
        alt="QFS"
        onerror="this.onerror=null; this.src='https://via.placeholder.com/40x40.png?text=QFS';" />
      <div>
        <h1>Admin Console</h1>
        <div class="sub">Credit/Debit USD + BTC (sats) · View balances · View ledger</div>
      </div>
    </div>

    <div class="actions">
      <span id="sessionPill" class="pill warn">Checking session…</span>
      <button id="refreshBtn" class="btn" type="button">Refresh</button>
      <button id="logoutBtn" class="btn" type="button">Logout</button>
    </div>
  </div>

  <div id="banner" class="banner hide"></div>

  <div class="grid">

    <!-- Members -->
    <div class="card">
      <h2>Members</h2>
      <div class="sub">Select a member to manage balances</div>

      <div class="row">
        <input id="searchInput" class="input" placeholder="Search by email or user_id (UUID)..." />
        <select id="filterSelect" class="select" style="max-width:190px;">
          <option value="all">All</option>
          <option value="active">Activated only</option>
          <option value="inactive">Pending only</option>
        </select>
        <button id="loadMembersBtn" class="btn" type="button">Load</button>
      </div>

      <div style="margin-top:10px; overflow:auto;">
        <table>
          <thead>
            <tr>
              <th>User ID</th>
              <th>Email</th>
              <th>Tier</th>
              <th>Qty</th>
              <th>Active</th>
            </tr>
          </thead>
          <tbody id="membersBody">
            <tr><td colspan="5" class="small">Loading…</td></tr>
          </tbody>
        </table>
      </div>

      <div class="row" style="justify-content:space-between;">
        <div class="small" id="pageInfo">—</div>
        <div class="row" style="gap:8px;">
          <button id="prevBtn" class="btn" type="button">Prev</button>
          <button id="nextBtn" class="btn" type="button">Next</button>
        </div>
      </div>
    </div>

    <!-- Selected Member -->
    <div class="card">
      <h2>Selected Member</h2>
      <div class="sub">Pick a member on the left, or paste a UUID below</div>

      <div class="row">
        <input id="selectedUserId" class="input mono" placeholder="Selected user_id (UUID)" />
        <button id="loadUserBtn" class="btn" type="button">Load</button>
      </div>

      <div class="split" style="margin-top:10px;">
        <div class="card" style="padding:12px; border-radius:18px;">
          <div class="small">USD Balance</div>
          <div style="font-size:18px; font-weight:950; margin-top:6px;" id="usdBal">$0.00</div>
          <div class="small">stored as cents</div>
        </div>
        <div class="card" style="padding:12px; border-radius:18px;">
          <div class="small">BTC Balance</div>
          <div style="font-size:18px; font-weight:950; margin-top:6px;" id="btcBal">0 sats</div>
          <div class="small">stored as sats</div>
        </div>
      </div>

      <div class="row" style="margin-top:12px; justify-content:space-between;">
        <div class="toggle">
          <div class="small">Activation</div>
          <div id="activeSwitch" class="switch"><div class="knob"></div></div>
          <span id="activeLabel" class="badge no">Pending</span>
        </div>
        <div class="small" id="userMeta">—</div>
      </div>

      <hr style="border:none; border-top:1px solid rgba(148,163,184,0.18); margin:14px 0;">

      <div class="split">
        <select id="currencySel" class="select">
          <option value="USD">USD</option>
          <option value="BTC">BTC</option>
        </select>

        <input id="amountInput" class="input" placeholder="Amount (USD dollars, BTC in sats)" />
      </div>

      <div class="split" style="margin-top:10px;">
        <select id="typeSel" class="select">
          <option value="credit">Credit</option>
          <option value="debit">Debit</option>
        </select>

        <input id="reasonInput" class="input" placeholder="Reason (e.g. welcome_credit, manual_adjust)" />
      </div>

      <div class="row" style="margin-top:10px;">
        <textarea id="metaInput" class="textarea mono" rows="3" placeholder='Optional note/metadata (saved). Example:
{"note":"manual top up"}'></textarea>
      </div>

      <div class="row" style="justify-content:flex-end;">
        <button id="submitBtn" class="btn" type="button">Submit</button>
      </div>

      <div class="small" style="margin-top:6px;">USD is converted to cents automatically. BTC expects sats.</div>

      <hr style="border:none; border-top:1px solid rgba(148,163,184,0.18); margin:14px 0;">

      <div class="row" style="justify-content:space-between;">
        <div>
          <div style="font-weight:950;">Recent Ledger</div>
          <div class="small">Last 25 entries (selected member)</div>
        </div>
        <button id="ledgerRefreshBtn" class="btn" type="button">Refresh</button>
      </div>

      <div style="margin-top:10px; overflow:auto; max-height:280px;">
        <table>
          <thead>
            <tr>
              <th>Time</th>
              <th>Cur</th>
              <th>Type</th>
              <th class="mono">Amount</th>
              <th>Reason</th>
            </tr>
          </thead>
          <tbody id="ledgerBody">
            <tr><td colspan="5" class="small">No member selected.</td></tr>
          </tbody>
        </table>
      </div>

    </div>

  </div>
</div>

<script>
  const CFG = window.__QFS_CONFIG || {};
  const SUPABASE_URL = CFG.SUPABASE_URL || "https://qagktukzxtwbjrdgiben.supabase.co";
  const SUPABASE_ANON_KEY = CFG.SUPABASE_ANON_KEY || "PASTE_ANON_KEY_HERE_IF_NO_CONFIG_JS";

  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const $ = (id) => document.getElementById(id);

  const banner = $("banner");
  function showBanner(msg, kind){
    banner.classList.remove("hide","err","ok");
    if(kind === "err") banner.classList.add("err");
    if(kind === "ok") banner.classList.add("ok");
    banner.textContent = String(msg || "");
  }
  function hideBanner(){
    banner.classList.add("hide");
    banner.textContent = "";
    banner.classList.remove("err","ok");
  }

  function esc(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function fmtUSDFromCents(cents){
    const usd = Number(cents || 0) / 100;
    return "$" + usd.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  }

  function parseMeta(){
    const raw = String($("metaInput").value || "").trim();
    if(!raw) return {};
    try{
      const obj = JSON.parse(raw);
      if(obj && typeof obj === "object") return obj;
    }catch{}
    return { note: raw };
  }

  async function getSession(){
    const { data, error } = await sb.auth.getSession();
    if(error) return null;
    return data?.session || null;
  }

  async function ensureAdmin(){
    // Uses RPC is_admin() provided by admin_rpcs.sql below
    const { data, error } = await sb.rpc("is_admin");
    if(error) throw new Error(error.message);
    return data === true;
  }

  let PAGE = 0;
  const PAGE_SIZE = 50;
  let MEMBERS = [];
  let SELECTED = null; // { user_id, email, tier, qty, is_active, created_at }

  function setSelectedUI(u){
    SELECTED = u || null;
    $("selectedUserId").value = u?.user_id || "";
    $("userMeta").textContent = u
      ? `${u.email || "—"} · ${String(u.tier || "—").toUpperCase()} · qty ${u.qty ?? "—"}`
      : "—";

    const isActive = !!u?.is_active;
    const sw = $("activeSwitch");
    sw.classList.toggle("on", isActive);
    $("activeLabel").textContent = isActive ? "Active" : "Pending";
    $("activeLabel").classList.toggle("ok", isActive);
    $("activeLabel").classList.toggle("no", !isActive);

    $("usdBal").textContent = "$0.00";
    $("btcBal").textContent = "0 sats";
    $("ledgerBody").innerHTML = `<tr><td colspan="5" class="small">${u ? "Loading…" : "No member selected."}</td></tr>`;
  }

  async function loadMembers(){
    hideBanner();
    $("membersBody").innerHTML = `<tr><td colspan="5" class="small">Loading…</td></tr>`;

    const search = String($("searchInput").value || "").trim();
    const filter = $("filterSelect").value;

    let activatedOnly = null;
    if(filter === "active") activatedOnly = true;
    if(filter === "inactive") activatedOnly = false;

    const { data, error } = await sb.rpc("admin_list_members", {
      p_search: search || null,
      p_activated_only: activatedOnly,
      p_limit: PAGE_SIZE,
      p_offset: PAGE * PAGE_SIZE
    });

    if(error){
      $("membersBody").innerHTML = `<tr><td colspan="5" class="small">Failed: ${esc(error.message)}</td></tr>`;
      showBanner("Members load failed:\n" + error.message, "err");
      return;
    }

    MEMBERS = data || [];
    if(MEMBERS.length === 0){
      $("membersBody").innerHTML = `<tr><td colspan="5" class="small">No members found.</td></tr>`;
      $("pageInfo").textContent = `Page ${PAGE+1}`;
      return;
    }

    $("membersBody").innerHTML = "";
    MEMBERS.forEach((m, idx) => {
      const active = m.is_active === true;
      const tr = document.createElement("tr");
      tr.className = "memberRow" + (SELECTED?.user_id === m.user_id ? " active" : "");
      tr.innerHTML = `
        <td class="mono">${esc(m.user_id)}</td>
        <td>${esc(m.email || "—")}</td>
        <td>${esc((m.tier || "").toUpperCase() || "—")}</td>
        <td>${esc(m.qty ?? "—")}</td>
        <td>${active ? '<span class="badge ok">Yes</span>' : '<span class="badge no">No</span>'}</td>
      `;
      tr.addEventListener("click", async () => {
        document.querySelectorAll(".memberRow").forEach(r => r.classList.remove("active"));
        tr.classList.add("active");
        setSelectedUI(m);
        await loadSelectedDetails();
      });
      $("membersBody").appendChild(tr);
    });

    $("pageInfo").textContent = `Page ${PAGE+1} · Loaded ${MEMBERS.length}`;
  }

  async function loadSelectedDetails(){
    if(!SELECTED?.user_id) return;

    // balances
    const { data: bals, error: bErr } = await sb.rpc("admin_get_user_balances", {
      p_user_id: SELECTED.user_id
    });
    if(bErr){
      showBanner("Balance load failed:\n" + bErr.message, "err");
    } else {
      const usd = (bals || []).find(x => String(x.currency || "").toUpperCase() === "USD");
      const btc = (bals || []).find(x => String(x.currency || "").toUpperCase() === "BTC");
      $("usdBal").textContent = fmtUSDFromCents(usd?.balance_cents || 0);
      $("btcBal").textContent = `${Number(btc?.balance_sats || 0).toLocaleString()} sats`;
    }

    await loadSelectedLedger();
  }

  async function loadSelectedLedger(){
    if(!SELECTED?.user_id){
      $("ledgerBody").innerHTML = `<tr><td colspan="5" class="small">No member selected.</td></tr>`;
      return;
    }

    $("ledgerBody").innerHTML = `<tr><td colspan="5" class="small">Loading…</td></tr>`;

    const { data, error } = await sb.rpc("admin_get_user_ledger", {
      p_user_id: SELECTED.user_id,
      p_limit: 25
    });

    if(error){
      $("ledgerBody").innerHTML = `<tr><td colspan="5" class="small">Ledger failed: ${esc(error.message)}</td></tr>`;
      return;
    }

    const rows = data || [];
    if(rows.length === 0){
      $("ledgerBody").innerHTML = `<tr><td colspan="5" class="small">No ledger entries.</td></tr>`;
      return;
    }

    $("ledgerBody").innerHTML = "";
    rows.forEach(r => {
      const dt = r.created_at ? new Date(r.created_at).toLocaleString() : "—";
      const cur = String(r.currency || "—").toUpperCase();
      const type = String(r.entry_type || "—").toLowerCase();

      let amt = "—";
      let cls = "";
      if(cur === "USD"){
        const cents = Number(r.amount_cents || 0);
        amt = fmtUSDFromCents(Math.abs(cents));
        if(type.includes("debit") || cents < 0) cls = "debit";
        else cls = "credit";
      } else if(cur === "BTC"){
        const sats = Number(r.amount_sats || 0);
        amt = `${Math.abs(sats).toLocaleString()} sats`;
        if(type.includes("debit") || sats < 0) cls = "debit";
        else cls = "credit";
      }

      $("ledgerBody").insertAdjacentHTML("beforeend", `
        <tr>
          <td>${esc(dt)}</td>
          <td>${esc(cur)}</td>
          <td>${esc(type)}</td>
          <td class="mono amt ${cls}">${esc((cls==="debit" ? "− " : "+ ") + amt)}</td>
          <td>${esc(r.reason || "—")}</td>
        </tr>
      `);
    });
  }

  async function toggleActivation(){
    if(!SELECTED?.user_id) return;

    const next = !(SELECTED.is_active === true);

    try{
      hideBanner();
      const { error } = await sb.rpc("admin_set_user_activation", {
        p_user_id: SELECTED.user_id,
        p_is_active: next,
        p_reason: "admin_toggle",
        p_metadata: { via: "admin.html" }
      });
      if(error) throw new Error(error.message);

      // Update local state + refresh
      SELECTED.is_active = next;
      setSelectedUI(SELECTED);
      await loadMembers();
      await loadSelectedDetails();
      showBanner("Activation updated ✅", "ok");
    } catch(e){
      showBanner("Activation update failed:\n" + (e?.message || e), "err");
    }
  }

  async function submitAdjustment(){
    if(!SELECTED?.user_id){
      showBanner("Select a member first.", "err");
      return;
    }

    const currency = $("currencySel").value;
    const type = $("typeSel").value;
    const reason = String($("reasonInput").value || "").trim() || "manual_adjust";
    const meta = parseMeta();
    const rawAmount = String($("amountInput").value || "").trim();

    const num = Number(rawAmount);
    if(!Number.isFinite(num) || num <= 0){
      showBanner("Enter a valid amount > 0.", "err");
      return;
    }

    // Convert: USD dollars -> cents, BTC -> sats (already)
    let amountBig = 0;
    if(currency === "USD"){
      amountBig = Math.round(num * 100);
    } else {
      amountBig = Math.round(num);
    }

    try{
      hideBanner();

      const { error } = await sb.rpc("admin_apply_balance_delta", {
        p_user_id: SELECTED.user_id,
        p_currency: currency,
        p_entry_type: type, // credit | debit
        p_amount: amountBig, // cents or sats
        p_reason: reason,
        p_metadata: meta
      });

      if(error) throw new Error(error.message);

      $("amountInput").value = "";
      showBanner("Balance updated ✅", "ok");
      await loadSelectedDetails();
    } catch(e){
      showBanner("Submit failed:\n" + (e?.message || e), "err");
    }
  }

  $("loadMembersBtn").addEventListener("click", async () => { PAGE = 0; await loadMembers(); });
  $("prevBtn").addEventListener("click", async () => { if(PAGE > 0){ PAGE--; await loadMembers(); } });
  $("nextBtn").addEventListener("click", async () => { PAGE++; await loadMembers(); });

  $("loadUserBtn").addEventListener("click", async () => {
    const uid = String($("selectedUserId").value || "").trim();
    if(!uid) return;

    const found = MEMBERS.find(m => m.user_id === uid) || null;
    if(found){
      setSelectedUI(found);
      await loadSelectedDetails();
      return;
    }

    // fetch single via admin_list_members search
    const { data, error } = await sb.rpc("admin_list_members", {
      p_search: uid,
      p_activated_only: null,
      p_limit: 1,
      p_offset: 0
    });
    if(error || !data || !data[0]){
      showBanner("Could not find that user_id via admin_list_members.", "err");
      return;
    }
    setSelectedUI(data[0]);
    await loadSelectedDetails();
  });

  $("activeSwitch").addEventListener("click", toggleActivation);
  $("submitBtn").addEventListener("click", submitAdjustment);
  $("ledgerRefreshBtn").addEventListener("click", loadSelectedLedger);

  $("refreshBtn").addEventListener("click", async () => {
    hideBanner();
    await boot(true);
  });

  $("logoutBtn").addEventListener("click", async () => {
    try{ await sb.auth.signOut(); } catch {}
    window.location.replace("login.html");
  });

  async function boot(isManual){
    const pill = $("sessionPill");
    try{
      pill.textContent = "Checking session…";
      pill.classList.remove("ok","warn");
      pill.classList.add("warn");

      const session = await getSession();
      if(!session){
        pill.textContent = "Not logged in";
        showBanner("No session. Please login first.", "err");
        return window.location.replace("login.html");
      }

      const user = session.user || {};
      const verifiedAt = user.email_confirmed_at || user.confirmed_at || null;
      if(!verifiedAt){
        showBanner("Email not verified. Please verify email then login again.", "err");
        try{ await sb.auth.signOut(); } catch {}
        return window.location.replace("login.html?msg=verify_email");
      }

      const ok = await ensureAdmin();
      if(!ok){
        pill.textContent = "Not authorized";
        showBanner("Not authorized: your account is not an admin.", "err");
        return;
      }

      pill.textContent = "Logged in";
      pill.classList.remove("warn");
      pill.classList.add("ok");

      await loadMembers();

      if(isManual) showBanner("Refreshed ✅", "ok");
      else hideBanner();
    } catch(e){
      pill.textContent = "Error";
      showBanner("Admin boot failed:\n" + (e?.message || e), "err");
    }
  }

  boot(false);
</script>
</body>
</html>
