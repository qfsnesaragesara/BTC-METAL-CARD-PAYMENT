<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Member Login — QFS</title>

  <!-- Website favicon / logo (same one you already use) -->
  <link rel="icon" type="image/png"
    href="https://github.com/qfsnesaragesara/BTC-METAL-CARD-PAYMENT/blob/main/photo%201.jpg?raw=true">

  <style>
    :root{
      --bg:#020617;
      --glass:rgba(15,23,42,0.86);
      --border:rgba(148,163,184,0.45);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#38bdf8;
      --accent2:#a855f7;
      --good:#22c55e;
      --bad:#ef4444;
      --warn:#fbbf24;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      background:
        radial-gradient(circle at top, rgba(56,189,248,0.32), transparent 55%),
        radial-gradient(circle at bottom, rgba(147,51,234,0.35), transparent 60%),
        var(--bg);
      color:var(--text);
    }
    .wrap{width:100%;max-width:520px}
    .card{
      width:100%;
      padding:26px;
      border-radius:26px;
      background:linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.82));
      border:1px solid var(--border);
      box-shadow:0 28px 90px rgba(0,0,0,0.55);
      backdrop-filter: blur(22px);
    }
    .brand{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    .brand img{
      width:52px;height:52px;border-radius:14px;
      border:1px solid rgba(255,255,255,0.18);
      box-shadow:0 10px 28px rgba(0,0,0,0.35);
    }
    h1{margin:0;font-size:20px;font-weight:900;letter-spacing:0.02em}
    p{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.5}
    label{display:block;margin-top:14px;margin-bottom:6px;color:var(--muted);font-size:12px}
    input{
      width:100%;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(255,255,255,0.06);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    .row{display:flex;gap:10px;margin-top:16px;flex-wrap:wrap}
    button{
      flex:1;
      padding:12px 14px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-weight:900;
      letter-spacing:0.06em;
      text-transform:uppercase;
      font-size:12px;
      min-width: 160px;
    }
    .btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:white}
    .btn-secondary{background:rgba(255,255,255,0.06);border:1px solid rgba(148,163,184,0.5);color:var(--text)}
    .btn-outline{background:transparent;border:1px solid rgba(56,189,248,0.55);color:#7dd3fc}
    .btn-muted{background:rgba(255,255,255,0.05);border:1px solid rgba(148,163,184,0.35);color:var(--text)}
    .msg{
      margin-top:14px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.35);
      background:rgba(2,6,23,0.4);
      color:var(--text);
      font-size:13px;
      line-height:1.4;
      white-space:pre-wrap;
    }
    .msg.ok{border-color:rgba(34,197,94,0.45)}
    .msg.error{border-color:rgba(239,68,68,0.45)}
    .msg.warn{border-color:rgba(251,191,36,0.45)}
    .tiny{margin-top:10px;color:var(--muted);font-size:12px}
    .tiny a{color:#7dd3fc;text-decoration:none}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="brand">
        <img src="https://github.com/qfsnesaragesara/BTC-METAL-CARD-PAYMENT/blob/main/photo%201.jpg?raw=true" alt="QFS Logo">
        <div>
          <h1>Member Login</h1>
          <p>Sign in to access your portal balance and membership status.</p>
        </div>
      </div>

      <label for="email">Email</label>
      <input id="email" type="email" placeholder="you@example.com" autocomplete="email" />

      <label for="password">Password</label>
      <input id="password" type="password" placeholder="Your password" autocomplete="current-password" />

      <div class="row">
        <button class="btn-primary" type="button" onclick="doLogin()">Login</button>
        <button class="btn-secondary" type="button" onclick="goRegister()">Create Account</button>
      </div>

      <div class="row">
        <button class="btn-outline" type="button" onclick="doSupabaseSignup()">Sign Up (Supabase)</button>
        <button class="btn-muted" type="button" onclick="doLogout()">Logout</button>
      </div>

      <div id="msg" class="msg warn">Ready.</div>

      <div class="tiny">
        If login does nothing, it usually means your Supabase keys are missing or the page is cached.
        Add <b>?v=1</b> to the URL to force refresh. Example: <b>login.html?v=1</b>
      </div>
    </div>
  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // =========================
    // ✅ PASTE YOUR KEYS HERE
    // =========================
    const SUPABASE_URL = "https://qagktukzxtwbjrdgiben.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhZ2t0dWt6eHR3YmpyZGdpYmVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NDA0NTQsImV4cCI6MjA4MzQxNjQ1NH0.cbhSWHGlmhmIt-NmUVBUtAhPpNPDKk4Bz-Gy1TbPzHk";

    // Where to go after login (change if you want)
    // If you already have only portal.html, set this to "portal.html"
    const AFTER_LOGIN_URL = "portal.html";

    const msgEl = document.getElementById("msg");
    const emailEl = document.getElementById("email");
    const passEl = document.getElementById("password");

    function showMsg(text, type){
      msgEl.className = "msg " + (type || "");
      msgEl.textContent = text;
    }

    // Hard checks so it NEVER silently "does nothing"
    if (!window.supabase) {
      showMsg("ERROR: Supabase library failed to load.\nCheck internet/CDN blocking.", "error");
    }

    if (!SUPABASE_URL.includes("http") || SUPABASE_ANON_KEY.includes("PASTE_")) {
      showMsg(
        "ERROR: Supabase keys are not set.\n\nPaste SUPABASE_URL and SUPABASE_ANON_KEY inside login.html (bottom script).",
        "error"
      );
    }

    const supabase = window.supabase
      ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
      : null;

    // --------- Button handlers (no forms, no preventDefault needed) ----------
    async function doLogin(){
      try{
        if(!supabase) { showMsg("Supabase not initialized. Check keys.", "error"); return; }

        const email = emailEl.value.trim();
        const password = passEl.value;

        if(!email || !password){
          showMsg("Enter email + password, then click Login.", "warn");
          return;
        }

        showMsg("Signing in…", "warn");

        const { data, error } = await supabase.auth.signInWithPassword({ email, password });

        if(error){
          showMsg("Login failed:\n" + error.message, "error");
          return;
        }

        showMsg("Login successful. Redirecting…", "ok");
        setTimeout(()=> window.location.href = AFTER_LOGIN_URL, 600);

      } catch(err){
        showMsg("Login error:\n" + (err?.message || String(err)), "error");
      }
    }

    function goRegister(){
      window.location.href = "registration.html";
    }

    // Optional: Supabase signup (you said you want to try create account + sign in)
    async function doSupabaseSignup(){
      try{
        if(!supabase) { showMsg("Supabase not initialized. Check keys.", "error"); return; }

        const email = emailEl.value.trim();
        const password = passEl.value;

        if(!email || !password){
          showMsg("Enter email + password first, then click Sign Up (Supabase).", "warn");
          return;
        }

        showMsg("Creating Supabase account…", "warn");

        const { data, error } = await supabase.auth.signUp({ email, password });

        if(error){
          showMsg("Sign up failed:\n" + error.message, "error");
          return;
        }

        showMsg(
          "Account created.\n\nIf 'Confirm email' is ON in Supabase, check your inbox and click the confirmation link.\nThen return here and Login.",
          "ok"
        );

      } catch(err){
        showMsg("Sign up error:\n" + (err?.message || String(err)), "error");
      }
    }

    async function doLogout(){
      try{
        if(!supabase) { showMsg("Supabase not initialized. Check keys.", "error"); return; }
        await supabase.auth.signOut();
        showMsg("Logged out.", "ok");
      } catch(err){
        showMsg("Logout error:\n" + (err?.message || String(err)), "error");
      }
    }

    // expose to onclick
    window.doLogin = doLogin;
    window.goRegister = goRegister;
    window.doSupabaseSignup = doSupabaseSignup;
    window.doLogout = doLogout;

    // On load: show whether a session exists
    (async function(){
      if(!supabase) return;
      const { data } = await supabase.auth.getSession();
      if(data?.session?.user?.email){
        showMsg("You are already signed in as:\n" + data.session.user.email, "ok");
      } else {
        showMsg("Ready. Enter your email + password and click Login.", "warn");
      }
    })();
  </script>
</body>
</html>
